local Player = game:GetService("Players").LocalPlayer
local RunService = game:GetService("RunService")

local Character = Player.Character or Player.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local RootPart = Character:WaitForChild("HumanoidRootPart")

local diagnostics = {
    lastPosition = RootPart.Position,
    stateChanges = 0,
    corrections = 0,
    physicsResets = 0
}

RunService.Heartbeat:Connect(function()
    local currentState = Humanoid:GetState()
    local isFlying = currentState == Enum.HumanoidStateType.Flying
    
    
    if isFlying then
        
        local displacement = (RootPart.Position - diagnostics.lastPosition).Magnitude
        if displacement > 50 then
            print("âš ï¸ å¼‚å¸¸ä½ç§»:", displacement, "ç±³")
        end
        diagnostics.lastPosition = RootPart.Position

        
        local ping = game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValue()
        if ping > 300 then
            print("âš ï¸ ç½‘ç»œå»¶è¿Ÿè¿‡é«˜:", ping, "ms") 
        end
    end
end)

local lastStablePos = RootPart.Position
RunService.Heartbeat:Connect(function()
    if Humanoid:GetState() ~= Enum.HumanoidStateType.Flying then return end

    
    if (RootPart.Position - lastStablePos).Magnitude > 15 then
        diagnostics.corrections = diagnostics.corrections + 1
        print("ğŸ› ï¸ ä½ç½®çº æ­£è§¦å‘ #"..diagnostics.corrections)
        RootPart.CFrame = CFrame.new(lastStablePos)
    else
        lastStablePos = RootPart.Position
    end

    
    if RootPart.AssemblyLinearVelocity.Magnitude > 10 then
        diagnostics.physicsResets = diagnostics.physicsResets + 1
        print("âš¡ ç‰©ç†é‡ç½® #"..diagnostics.physicsResets)
        RootPart.AssemblyLinearVelocity = Vector3.new(0,0,0)
    end
end)

game:GetService("UserInputService").InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.F5 then
        print("\n=== é£è¡Œè¯Šæ–­æŠ¥å‘Š ===")
        print("ä½ç½®çº æ­£æ¬¡æ•°:", diagnostics.corrections)
        print("ç‰©ç†é‡ç½®æ¬¡æ•°:", diagnostics.physicsResets)
        print("å½“å‰ç½‘ç»œå»¶è¿Ÿ:", game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValue().."ms")
        print("====================")
    end
end)

game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "âœ… æ¿€æ´»",
    Text = "æŒ‰F5æŸ¥çœ‹é£è¡Œæ•°æ®",
    Duration = 5
})
