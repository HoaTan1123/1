local Player = game:GetService("Players").LocalPlayer
local RunService = game:GetService("RunService")

-- æš´åŠ›åŠ è½½è§’è‰²ç»„ä»¶ï¼ˆç¡®ä¿100%åŠ è½½æˆåŠŸï¼‰
local Character = Player.Character
if not Character then
    for _ = 1, 30 do
        Character = Player.Character
        if Character then break end
        task.wait(0.1)
    end
    if not Character then Character = Player.CharacterAdded:Wait() end
end

-- ç¡®ä¿å…³é”®ç»„ä»¶å­˜åœ¨ï¼ˆå…¼å®¹å„ç§è§’è‰²æ¨¡å‹ï¼‰
local Humanoid, RootPart
for _ = 1, 50 do
    Humanoid = Character:FindFirstChildOfClass("Humanoid")
    RootPart = Character:FindFirstChild("HumanoidRootPart") or Character:FindFirstChild("Torso") or Character:FindFirstChild("UpperTorso")
    if Humanoid and RootPart then break end
    task.wait(0.1)
end

-- ç¦ç”¨æ‰€æœ‰å¯èƒ½å¯¼è‡´æ‹‰å›çš„çŠ¶æ€
for _, state in pairs(Enum.HumanoidStateType:GetEnumItems()) do
    pcall(function() Humanoid:SetStateEnabled(state, false) end)
end

-- å®Œå…¨è§£é™¤ç‰©ç†é™åˆ¶
for _, part in pairs(Character:GetDescendants()) do
    if part:IsA("BasePart") then
        part.CanCollide = false
        part.CanTouch = false
        part.Anchored = false
        part.AssemblyLinearVelocity = Vector3.new()
        part.AssemblyAngularVelocity = Vector3.new()
    end
end

-- æ ¸å¿ƒåæ‹‰å›ç³»ç»Ÿï¼ˆä½ç½®å†å²ç¼“å†²ï¼‰
local PositionHistory = {}
local HISTORY_SIZE = 12 -- æ¯”å¸¸è§„æ›´å¤§çš„ç¼“å†²åŒº

-- å¡«å……åˆå§‹ä½ç½®
for _ = 1, HISTORY_SIZE do
    table.insert(PositionHistory, RootPart.Position)
end

-- æ™ºèƒ½ä½ç½®ä¿æŠ¤ç³»ç»Ÿ
RunService.Heartbeat:Connect(function()
    -- æ›´æ–°ä½ç½®å†å²
    table.insert(PositionHistory, 1, RootPart.Position)
    if #PositionHistory > HISTORY_SIZE then
        table.remove(PositionHistory)
    end

    -- è®¡ç®—å¹³æ»‘ä½ç½®ï¼ˆå–å†å²ä¸­é—´å€¼ï¼‰
    local avgPos = Vector3.new()
    for _, pos in ipairs(PositionHistory) do
        avgPos = avgPos + pos
    end
    avgPos = avgPos / #PositionHistory

    -- æ¸è¿›å¼ä½ç½®ä¿®æ­£ï¼ˆæ— æ„ŸçŸ¥è¿‡æ¸¡ï¼‰
    if (RootPart.Position - avgPos).Magnitude > 2 then
        local tweenInfo = TweenInfo.new(
            0.3, -- è¿‡æ¸¡æ—¶é—´
            Enum.EasingStyle.Quad, -- ç¼“åŠ¨æ›²çº¿
            Enum.EasingDirection.Out
        )
        TweenService:Create(
            RootPart,
            tweenInfo,
            {CFrame = CFrame.new(avgPos)}
        ):Play()
    end
end)

-- åæ£€æµ‹ä¼ªè£…ç³»ç»Ÿ
task.spawn(function()
    while true do
        -- éšæœºå¾®å°åŠ¨ä½œï¼ˆæ¨¡æ‹Ÿæ­£å¸¸ç©å®¶ï¼‰
        if math.random() < 0.15 then
            Humanoid.Jump = true
        end
        task.wait(math.random(0.3, 1.2))
    end
end)

-- å¯åŠ¨é€šçŸ¥ï¼ˆä»…æ˜¾ç¤ºä¸€æ¬¡ï¼‰
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "ğŸ›¡ï¸ åæ‹‰å›ç³»ç»Ÿå·²æ¿€æ´»",
    Text = "ç°åœ¨å¯ä»¥è‡ªç”±ä½¿ç”¨ä»»ä½•é£è¡Œè„šæœ¬",
    Duration = 3
})
